<div class="relative z-10 h-full overflow-hidden shrink-0 transition-[width] duration-300 ease-in-out"
  :style="{ width: sidebarOpen ? '33.333%' : '0' }">
  <div id="sidebar" class="relative h-full pb-8 overflow-y-auto border-r-2 border-black border-solid" style="min-width: 280px;">
    <div class="p-4">
    <h2 class="mb-4 text-[2rem] leading-[2.5rem] font-bold">Hero</h2>
    <!-- Background Color Selector -->
    <div class="mb-4">
      <label class="block mb-2 font-semibold">Background Color</label>
      <div class="relative" @click.away="open = false" x-data="{ open: false, color: availableBackgroundColors.find(color => color.default_background)?.color_name || 'White' }">
        <button @click="open = !open" :class="{'border-[#616161] rounded-t-md rounded-b-[transparent] open': open, 'border-gray-300 rounded-md': !open}" class="flex items-center justify-between w-full p-2 border-2 select-input">
          <span x-text="color"></span>
          <svg :class="{'rotate-180': !open}" class="w-4 h-4 transition-transform transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
          </svg>
        </button>
        <div x-show="open" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 transform scale-95" x-transition:enter-end="opacity-100 transform scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 transform scale-100" x-transition:leave-end="opacity-0 transform scale-95" class="absolute z-10 w-full bg-white border-2 overflow-hidden border-[#616161] border-t-0 rounded-b-md shadow-lg text-start">
          <template x-for="colorOption in availableBackgroundColors" :key="colorOption.color_value">
            <div class="p-2 cursor-pointer hover:bg-gray-100" @click="color = colorOption.color_name; open = false; updateBackgroundColor(colorOption.color_value)" :data-value="colorOption.color_value" x-text="colorOption.color_name"></div>
          </template>
        </div>
      </div>
    </div>

    <div id="content-blocks-container" x-on:drop.prevent="reorderBlocks($event)" x-on:dragover.prevent="event.dataTransfer.dropEffect = 'move'">
      <label class="block mb-2 font-semibold">Content Blocks</label>
      <template x-for="(block, index) in blocks" :key="block.id">
        <div :style="{ order: block.order }" class="p-[10px] bg-white border-2 border-solid border-[#cfcfcf] bt-none cursor-pointer [transition:_background-color_0.2s_ease-in-out] hover:border-[#616161] hover:bg-gray-100" :class="{
          'content-block': true,
          'single': blocks.length === 1,
          'first': blocks.length > 1 && index === 0,
          'last': blocks.length > 1 && index === blocks.length - 1,
          'middle': blocks.length > 2 && index !== 0 && index !== blocks.length - 1
        }" :id="block.id" draggable="true" @dragstart="startDragging($event, block.id)" @dragend="endDragging()">
          <div class="grid [grid-template-columns:_1fr_25px] justify-between">
            <div class="flex gap-[10px]" @click="openPanel(block.panelId)">
              <div class="w-[48px] h-[48px]">
                <template x-if="block.type === 'text-block'">
                  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M14.59 2.59c-.38-.38-.89-.59-1.42-.59H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.41l-4.82-4.83zM15 18H9c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm0-4H9c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm-2-6V3.5L18.5 9H14c-.55 0-1-.45-1-1z"></path>
                  </svg>
                </template>
                <template x-if="block.type === 'image-block'">
                  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.9 13.98l2.1 2.53 3.1-3.99c.2-.26.6-.26.8.01l3.51 4.68a.5.5 0 0 1-.4.8H6.02c-.42 0-.65-.48-.39-.81L8.12 14c.19-.26.57-.27.78-.02z"></path>
                  </svg>
                </template>
                <template x-if="block.type === 'button-block'">
                  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M22 9v6c0 1.1-.9 2-2 2h-1v-2h1V9H4v6h6v2H4c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2zm-7.96 8.99a.5.5 0 0 0 .91 0l.63-1.4 1.4-.63a.5.5 0 0 0 0-.91l-1.4-.63-.63-1.4a.5.5 0 0 0-.91 0l-.63 1.4-1.4.63a.5.5 0 0 0 0 .91l1.4.63.63 1.4zm2.7-4.56c.1.22.42.22.52 0l.36-.8.8-.36c.22-.1.22-.42 0-.52l-.8-.36-.36-.8a.287.287 0 0 0-.52 0l-.36.8-.8.36c-.22.1-.22.42 0 .52l.8.36.36.8z"></path>
                  </svg>
                </template>
              </div>
              <div class="flex flex-col gap-1 justify-center">
                <p class="font-semibold leading-none block-title" x-text="block.title"></p>
                <p class="block-description text-[14px] text-[#393939]" :id="block.labelId" x-text="block.label"></p>
              </div>
            </div>
            <div class="relative cursor-grab" @click.away="closeBlockMenu(block.id)">
              <button @click.stop="toggleBlockMenu(block.id)" class="flex items-center justify-center w-6 h-6 text-gray-600 p-[1px] rounded-md hover:bg-[#cfcfcf] box-content cursor-grab" aria-label="Menu">
                <svg class="fill-[#393939]" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                  <path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
                </svg>
              </button>
              <div :id="block.menuId" class="absolute right-0 z-30 hidden w-48 py-2 mt-2 bg-white border-2 rounded shadow-xl">
                <button class="flex items-center w-full px-4 py-2 text-left hover:bg-gray-100" @click="moveBlock(block.id, 'up')">
                  <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                  </svg>
                  Move Up
                </button>
                <button class="flex items-center w-full px-4 py-2 text-left hover:bg-gray-100" @click="moveBlock(block.id, 'down')">
                  <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                  Move Down
                </button>
                <button class="flex items-center w-full px-4 py-2 text-left hover:bg-gray-100" @click="deleteBlock(block.id, $event)">
                  <svg class="w-4 h-4 mr-2" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z"></path></svg>
                  Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      </template>
    </div>

    <div class="mt-4">
      <button @click="toggleAddContentMenu; contentAdded = true" @click.away="closeAddContentMenu" class="relative flex items-center w-fit text-cc leading-[1.4] border-2 border-solid border-[#cfcfcf] font-bold rounded-lg px-5 py-2 hover:border-[color-mix(in_srgb,#034AD8_80%,#393939)] hover:bg-[rgba(3,75,216,0.05)]">
        <svg class="fill-cc" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1z"></path></svg>
        <span class="leading-none">Add Content Block</span>
        <span class="absolute top-[-4px] right-[-5px] flex w-3 h-3" x-show="!contentAdded" @click="contentAdded = true">
          <span class="absolute inline-flex w-full h-full rounded-full opacity-75 animate-ping bg-[#B9E5E3]"></span>
          <span class="relative inline-flex w-3 h-3 rounded-full bg-[#B9E5E3]"></span>
        </span>
      </button>
      <div id="add-content-menu" class="hidden mt-2 bg-white border-2 rounded shadow-lg">
        <template x-for="(blockType, index) in blockTypes" :key="index">
          <div class="p-2 cursor-pointer hover:bg-gray-100" @click="addContentBlock(blockType)">
            <div class="flex items-center space-x-2">
              <div class="p-2">
                <template x-if="blockType.type === 'text-block'">
                  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M14.59 2.59c-.38-.38-.89-.59-1.42-.59H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.41l-4.82-4.83zM15 18H9c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm0-4H9c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1zm-2-6V3.5L18.5 9H14c-.55 0-1-.45-1-1z"></path>
                  </svg>
                </template>
                <template x-if="blockType.type === 'image-block'">
                  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.9 13.98l2.1 2.53 3.1-3.99c.2-.26.6-.26.8.01l3.51 4.68a.5.5 0 0 1-.4.8H6.02c-.42 0-.65-.48-.39-.81L8.12 14c.19-.26.57-.27.78-.02z"></path>
                  </svg>
                </template>
                <template x-if="blockType.type === 'button-block'">
                  <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <path d="M22 9v6c0 1.1-.9 2-2 2h-1v-2h1V9H4v6h6v2H4c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h16c1.1 0 2 .9 2 2zm-7.96 8.99a.5.5 0 0 0 .91 0l.63-1.4 1.4-.63a.5.5 0 0 0 0-.91l-1.4-.63-.63-1.4a.5.5 0 0 0-.91 0l-.63 1.4-1.4.63a.5.5 0 0 0 0 .91l1.4.63.63 1.4zm2.7-4.56c.1.22.42.22.52 0l.36-.8.8-.36c.22-.1.22-.42 0-.52l-.8-.36-.36-.8a.287.287 0 0 0-.52 0l-.36.8-.8.36c-.22.1-.22.42 0 .52l.8.36.36.8z"></path>
                  </svg>
                </template>
              </div>
              <div>
                <p x-text="blockType.name"></p>
              </div>
            </div>
          </div>
        </template>
      </div>
    </div>
  </div>

  <!-- Component Panels -->
  <div id="component-panels">
    <template x-for="(block, index) in blocks" :key="block.panelId">
      <div :id="block.panelId" class="component-panel absolute inset-y-0 left-0 z-20 hidden w-full p-4 overflow-y-auto transition-transform transform bg-white rounded-md shadow duration-[0.4s] translate-x-full">
        <button class="flex items-center gap-1 p-2 pl-0 font-bold text-cc" @click="closePanel">
          <svg class="fill-cc" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42a.996.996 0 0 0-1.41 0l-6.59 6.59a.996.996 0 0 0 0 1.41l6.59 6.59a.996.996 0 1 0 1.41-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"></path></svg>
          <span>Back</span>
        </button>
        <template x-if="block.type === 'text-block'">
          <div>
            <h2 class="mb-2 text-2xl font-bold">{{ content.text_component.name}}</h2>
            <div class="space-y-4">
              <div class="flex flex-col space-y-2">
                <label class="font-semibold">Heading</label>
                <input class="p-2 border-2 rounded-md hover:border-[#616161]" type="text" x-model="block.heading">
              </div>
              <div class="flex flex-col space-y-2">
                <label class="font-semibold">Content</label>
                <textarea class="p-2 border-2 rounded-md hover:border-[#616161]" rows="10" x-model="block.content"></textarea>
              </div>
            </div>
          </div>
        </template>
        <template x-if="block.type === 'image-block'">
          <div>
            <h2 class="mb-2 text-2xl font-bold">{{ content.image_component.name }}</h2>
            <div class="space-y-4">
              <div class="flex flex-col space-y-2">
                <label class="font-semibold">Image</label>
                <div class="relative">
                  <img decoding="async" loading="lazy" class="object-contain w-full p-2 border-2 rounded-md h-60 hover:border-[#616161]" :src="block.image" :data-input="block.previewImageId" alt="Placeholder">
                  <button class="absolute inset-0 flex overflow-hidden flex-col items-center w-full h-full py-8 bg-white opacity-0 justify-evenly pb-[2rem] p-1 hover:opacity-90 border-2 border-solid rounded-lg border-[#616161]" @click="handleImageInputClick($event, block.id)">
                    <div class="w-[48px] h-[48px]">
                      <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="m19.41 7.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8.83c0-.53-.21-1.04-.59-1.42zM14.8 15H13v3c0 .55-.45 1-1 1s-1-.45-1-1v-3H9.21c-.45 0-.67-.54-.35-.85l2.8-2.79c.2-.19.51-.19.71 0l2.79 2.79c.3.31.08.85-.36.85zM14 9c-.55 0-1-.45-1-1V3.5L18.5 9H14z"></path>
                      </svg>
                    </div>
                    <span class="block text-[#616161] break-all text-center mt-1 overflow-hidden" x-text="block.image"></span>
                    <span class="block font-bold leading-5 text-center cursor-pointer text-cc">Click to change image</span>
                  </button>
                </div>
              </div>                  
            </div>
          </div>
        </template>
        <template x-if="block.type === 'button-block'">
          <div>
            <h2 class="mb-2 text-2xl font-bold">{{ content.button_component.name }}</h2>
            <div class="space-y-4">
              <div class="flex flex-col space-y-2">
                <label class="font-semibold">Text</label>
                <input class="p-2 border-2 rounded-md hover:border-[#616161]" type="text" x-model="block.buttonText">
              </div>
              <div class="flex flex-col space-y-2">
                <label class="font-semibold">Link URL</label>
                <input class="p-2 border-2 rounded-md hover:border-[#616161]" type="text">
              </div>
              <div class="flex flex-col space-y-2">
                <label class="font-semibold">Color</label>
                <div class="relative" @click.away="open = false" x-data="{ open: false, color: availableButtonColors.find(color => color.default_background)?.color_name || 'Dark Purple' }">
                  <button @click="open = !open" :class="{'border-[#616161] rounded-t-md rounded-b-none open': open, 'border-gray-300 rounded-md': !open}" class="flex items-center justify-between w-full p-2 border-2 select-input">
                    <span x-text="color"></span>
                    <svg :class="{'rotate-180': !open}" class="w-4 h-4 transition-transform transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                    </svg>
                  </button>
                  <div x-show="open" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="opacity-0 transform scale-95" x-transition:enter-end="opacity-100 transform scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="opacity-100 transform scale-100" x-transition:leave-end="opacity-0 transform scale-95" class="absolute z-10 w-full bg-white border-2 overflow-hidden border-[#616161] border-t-0 rounded-b-md shadow-lg text-start">
                    <template x-for="colorOption in availableButtonColors" :key="colorOption.color_value">
                      <div class="p-2 cursor-pointer hover:bg-gray-100" @click="color = colorOption.color_name; open = false; updateButtonColor($event, colorOption.color_value, block.id)" :data-value="colorOption.color_value" x-text="colorOption.color_name"></div>
                    </template>
                  </div>
                </div>
              </div>
            
            </div>
          </div>
        </template>
      </div>
    </template>
  </div>
  </div>
</div>